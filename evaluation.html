<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EPS Matrix ‚Äì √âvaluation</title>
  <script>
    (function(){
      try{
        const stored = localStorage.getItem('eps.matrix.theme');
        if(stored){ document.documentElement.dataset.theme = stored; }
      }catch(_e){}
    })();
  </script>
  <link rel="stylesheet" href="styles.css" />
  <script defer src="theme.js"></script>
  <script defer src="app.js"></script>
  <script defer src="prompt-modal.js"></script>
  <script defer src="evaluation.js"></script>
</head>
<body>
  <button class="themeToggle" id="themeToggle" aria-label="Mode nuit">üåô</button>
  <main class="card-full" style="gap:24px;">
    <header class="app">
      <div>
        <h2 id="evalTitle">√âvaluation</h2>
        <p id="evalMeta" class="dragHint"></p>
      </div>
      <div class="navButtons">
        <a class="btn secondary" id="backClass" href="classes.html">‚Üê Retour classe</a>
        <button class="btn secondary" id="btnConfigure">Configurer</button>
        <button class="btn secondary" id="btnScoring">Notation</button>
        <button class="btn secondary" id="btnToggleNote">Afficher la note</button>
        <button class="btn secondary" id="btnExportCsv">Sauvegarder CSV</button>
        <label class="btn secondary" style="cursor:pointer;">
          Importer CSV
          <input type="file" id="inputImportCsv" accept=".csv,text/csv" hidden />
        </label>
        <button class="btn secondary" id="btnExportPdf">PDF</button>
        <button class="btn secondary" id="btnTableOnly">Plein √©cran</button>
        <a class="btn secondary" href="help.html" target="_blank" rel="noopener">Aide</a>
      </div>
    </header>
    <div class="stats" id="evalStats"></div>
    <section class="terrainPanel" id="terrainPanel">
      <div class="terrainPanelHeader">
        <div class="terrainToggleRow">
          <label>
            <input type="checkbox" id="toggleTerrainMode" />
            Mode terrain
          </label>
          <p class="muted smallText">Organise rapidement tes terrains et arbitres.</p>
        </div>
        <div class="terrainConfig">
          <label>Terrains
            <input type="number" id="terrainCountInput" min="1" max="8" value="4" />
          </label>
          <button class="btn secondary" type="button" id="btnInitTerrains">Initialiser les terrains</button>
        </div>
      </div>
      <p class="muted" id="terrainDisabledHint">Active le mode terrain pour afficher les cartes.</p>
      <div class="terrainGrid" id="terrainGrid"></div>
      <div class="terrainDetail hidden" id="terrainDetail">
        <div class="terrainDetailHeader">
          <button class="btn secondary" type="button" id="btnTerrainBack">‚Üê Vue globale</button>
          <div class="terrainDetailNav">
            <button class="btn secondary" type="button" id="btnTerrainPrev">Terrain pr√©c√©dent</button>
            <button class="btn secondary" type="button" id="btnTerrainNext">Terrain suivant</button>
          </div>
        </div>
        <h3 id="terrainDetailTitle">Terrain</h3>
        <p id="terrainDetailRef" class="muted"></p>
        <div id="terrainDetailPlayers" class="terrainDetailPlayers"></div>
        <label class="terrainScoreField">Score / note
          <input type="text" id="terrainScoreInput" placeholder="ex : 11-9" />
        </label>
        <div class="terrainDetailActions">
          <button class="btn primary" type="button" id="btnValidateMatch">Valider le match</button>
        </div>
        <div class="terrainMatches">
          <h4>Matches r√©cents</h4>
          <ul id="terrainMatchesList"></ul>
        </div>
      </div>
    </section>
    <div class="tableWrapper">
      <table>
        <thead><tr id="thead"></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    <section class="resultsPanel hidden" id="resultsPanel">
      <div class="sectionHeader">
        <h3>Mode terrain ‚Äì R√©sultats</h3>
        <button class="btn secondary" type="button" id="btnExportResultsCsv">Exporter les r√©sultats</button>
      </div>
      <div class="tableWrapper">
        <table>
          <thead>
            <tr>
              <th>Rang</th>
              <th>√âl√®ve</th>
              <th>D√©part</th>
              <th>Terrain actuel</th>
              <th>Matchs</th>
              <th>Gagn√©s</th>
              <th>Perdus</th>
              <th>Points</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div class="modal hidden" id="configModal" role="dialog" aria-modal="true">
    <div class="modalCard large">
      <div class="modalHeader">
        <h2>Configurer la grille</h2>
        <button class="iconButton" data-close-modal>&times;</button>
      </div>
      <p class="muted">S√©lectionne les champs de base √† afficher puis compose tes crit√®res.</p>
      <section class="baseFieldsPanel">
        <h3>Champs de base</h3>
        <div id="baseFieldOptions" class="baseFieldGrid"></div>
      </section>
      <section>
        <h3>Crit√®res</h3>
        <div id="configList" class="criteriaList"></div>
      </section>
      <div class="actions modalActions">
        <button class="btn secondary" id="btnAddCriterion" type="button">+ Ajouter un crit√®re</button>
        <button class="btn secondary" id="btnChatGPT" type="button">Pense-b√™te ChatGPT</button>
        <span class="flex-fill"></span>
        <button class="btn secondary" data-close-modal type="button">Annuler</button>
        <button class="btn primary" id="btnSaveCriteria" type="button">Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="modal hidden" id="scoringModal" role="dialog" aria-modal="true">
    <div class="modalCard large">
      <div class="modalHeader">
        <h2>Notation</h2>
        <button class="iconButton" data-close-modal>&times;</button>
      </div>
      <p class="muted">Attribue des points √† chaque option. Ces valeurs alimentent automatiquement la note sur 20.</p>
      <div id="scoringList" class="criteriaList"></div>
      <div class="actions modalActions">
        <span class="flex-fill"></span>
        <button class="btn secondary" data-close-modal type="button">Annuler</button>
        <button class="btn primary" id="btnSaveScoring" type="button">Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="modal hidden" id="chatgptModal" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="modalHeader">
        <h2>Pense-b√™te ChatGPT</h2>
        <button class="iconButton" data-close-modal>&times;</button>
      </div>
      <p class="muted">Copie le prompt ci-dessous pour g√©n√©rer des crit√®res conformes aux derniers programmes EPS.</p>
      <textarea id="chatgptPrompt" style="width:100%;min-height:160px;border-radius:18px;border:1px solid var(--line);padding:16px;font-family:inherit;"></textarea>
      <div class="actions" style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;">
        <button class="btn secondary" id="btnCopyPrompt" type="button">Copier le prompt</button>
        <button class="btn primary" id="btnOpenChatGPT" type="button">Ouvrir chatgpt.com</button>
      </div>
    </div>
  </div>

  <div class="modal hidden" id="terrainNoteModal" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="modalHeader">
        <h2>Note terrain</h2>
        <button class="iconButton" data-close-modal>&times;</button>
      </div>
      <p class="muted">Saisis une note libre visible dans le mode terrain.</p>
      <textarea id="terrainNoteInput" style="width:100%;min-height:160px;border-radius:16px;border:1px solid var(--line);padding:12px;font-family:inherit;"></textarea>
      <div class="actions modalActions">
        <span class="flex-fill"></span>
        <button class="btn secondary" type="button" data-close-modal>Annuler</button>
        <button class="btn primary" type="button" id="btnSaveTerrainNote">Enregistrer</button>
      </div>
    </div>
  </div>
</body>
</html>
